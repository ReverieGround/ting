# 기능 및 사용자 플로우

## 앱 개요

**VibeYum (T!ng)** 은 음식 경험을 공유하고, 레시피를 탐색하며, 음식을 사랑하는 사람들과 연결하는 한국 소셜 푸드 커뮤니티 앱입니다.

- **브랜드명**: T!ng
- **패키지명**: VibeYum
- **슬로건**: "전 세계의 맛있는 순간을 함께 기록해요"
- **지원 언어**: 한국어 (기본), 영어 (폴백)
- **플랫폼**: iOS (주력), Android, macOS/Windows/Linux (데스크탑 지원)

---

## 주요 기능 목록

| 기능 | 설명 |
|------|------|
| 소셜 로그인 | Google, Facebook, Kakao, Naver + 바이오메트릭 자동 로그인 |
| 온보딩 | 닉네임, 국가, 프로필 이미지, 한 줄 소개 설정 |
| 피드 (커뮤니티) | 실시간/인기/Wack/개인 피드 필터링 |
| 포스트 작성 | 멀티 이미지 + 카테고리 + 리뷰 값 + 텍스트 |
| 레시피 탐색 | Firestore 기반 레시피 목록 및 상세 보기 |
| 레시피 편집/기록 | 음성 입력 + GPT 연동으로 레시피 수정 |
| 프로필 | 포스트 그리드, 핀 포스트, 통계 (팔로워/팔로잉/포스트) |
| 게스트북 | 프로필에 스티키 노트 남기기 |
| 팔로우/차단 | 양방향 팔로우 + 차단 시스템 |
| 좋아요/댓글 | 실시간 좋아요/댓글 카운트 및 스트림 |
| 핀 (Pin) | 중요한 포스트 고정 |
| 공개범위 | PUBLIC / FOLLOWER / PRIVATE 3단계 가시성 |

---

## 사용자 여정 (User Journeys)

### 1. 로그인 → 온보딩 → 홈

```
앱 실행
  ↓
SplashPage (초기화)
  ↓
AppState.bootstrap() 실행
  ├── 로그인 기록 없음 → LoginPage
  │     ├── 소셜 로그인 (Google/Facebook/Kakao/Naver) 선택
  │     └── 로그인 성공 → 사용자 문서 확인
  │           ├── user_name/country_code 미설정 → OnboardingPage
  │           │     ├── 닉네임, 국가, 프로필 이미지, 한 줄 소개 입력
  │           │     ├── "시작하기" 또는 "나중에 할래요" 선택
  │           │     └── AppState → authenticated → HomePage
  │           └── 이미 설정됨 → HomePage
  └── 로그인 기록 있음 + 토큰 유효
        └── 바이오메트릭 인증 시도 → 성공 시 HomePage
```

### 2. 포스트 작성 플로우

```
CreatePostPage 진입
  ↓
이미지 선택 (멀티 이미지 picker)
  ├── 1장: 즉시 반환
  └── 2장+: EditPage (드래그 정렬, 크롭, 삭제)
  ↓
이미지별 입력 (PageView 스와이프)
  ├── 카테고리 선택: 요리 / 밀키트 / 식당 / 배달
  ├── 리뷰 값 선택: Fire / Tasty / Soso / Woops / Wack
  ├── 텍스트 입력
  ├── 촬영 일시 설정 (EXIF 자동 추출 또는 수동)
  └── 카테고리별 추가 입력
        ├── 요리 → 레시피 추천 토글
        ├── 밀키트 → 구매 링크
        ├── 식당 → 식당 링크
        └── 배달 → 배달 링크
  ↓
유효성 검증 (빈 필드 하이라이트)
  ↓
ConfirmPage
  ├── 이미지 미리보기 (스택 카드)
  ├── 공개범위 선택 (PUBLIC/FOLLOWER/PRIVATE)
  └── 업로드 (Firebase Storage → Firestore)
  ↓
완료 → 이전 화면 복귀
```

### 3. 레시피 조리 플로우

```
RecipeListPage (홈 → 요리하기 탭)
  ↓
최신 레시피 목록 (이미지 + 제목)
  ↓
RecipeDetailPage
  ├── 대표 이미지
  ├── 영양 정보 (칼로리, 단백질, 탄수화물, 지방, 나트륨)
  ├── 재료 목록
  ├── 조리 방법 (단계별 이미지 포함)
  └── "요리하고 공유하기" 버튼
  ↓
RecipeEditPage
  ├── 원본 레시피 보기 (접기/펼치기)
  ├── 재료 편집 (그리드, 개별 삭제)
  ├── 조리법 편집 (번호 매겨진 단계)
  ├── 음성 입력 (한국어/영어 음성 인식)
  │     └── GPT-4o-mini로 레시피 수정 사항 반영
  ├── 수동 텍스트 메모 입력
  └── 완성 사진 촬영 → 포스트로 공유
```

### 4. 프로필 탐색 플로우

```
ProfilePage (홈 → 프로필 탭 또는 다른 사용자 클릭)
  ↓
ProfileHeader
  ├── 프로필 이미지, 닉네임, 칭호
  ├── 상태 메시지 (편집 가능, 본인만)
  └── 통계: 포스트 / 레시피 / 팔로워 / 팔로잉
        └── 클릭 → UserListPage (팔로워/팔로잉/차단 탭)
  ↓
탭 콘텐츠 (3개 탭)
  ├── Yum 탭: 포스트 3열 그리드
  │     ├── 이미지 탭 → PostPage (포스트 상세)
  │     └── 롱프레스 → 미리보기 + 핀 토글
  ├── 레시피 탭: 레시피 컬렉션
  └── 게스트북 탭: 스티키 노트 벽
        ├── 노트 작성 (텍스트 + 색상 선택)
        ├── 노트 편집/삭제
        └── 핀 고정
```

---

## 각 기능 세부 설명

### 카테고리 시스템

포스트 작성 시 4가지 카테고리 중 하나를 선택합니다:

| 카테고리 | 설명 | 추가 입력 |
|---------|------|----------|
| 요리 | 직접 만든 요리 | 레시피 추천 토글 |
| 밀키트 | 밀키트 제품 리뷰 | 구매 링크 |
| 식당 | 외식 경험 | 식당 링크 |
| 배달 | 배달 음식 리뷰 | 배달 링크 |

### 리뷰 값 (Value) 시스템

각 포스트에 맛 평가를 5단계로 표현합니다:

| 값 | 아이콘 | 의미 |
|---|--------|------|
| Fire | `assets/fire.png` | 최고! 불맛! |
| Tasty | `assets/tasty.png` | 맛있다 |
| Soso | `assets/soso.png` | 그저 그렇다 |
| Woops | `assets/woops.png` | 아쉽다 |
| Wack | `assets/wack.png` | 별로다 |

> `Wack` 평가 포스트는 별도의 "Wack 피드"에서 모아볼 수 있습니다.

### 공개범위 (Visibility)

| 레벨 | 볼 수 있는 사람 |
|------|---------------|
| `PUBLIC` | 모든 사용자 |
| `FOLLOWER` | 팔로워만 |
| `PRIVATE` | 본인만 |

공개범위는 포스트 작성 시 `ConfirmPage`에서 설정하며, 작성 후에도 `PostMetaEditSheet`에서 변경할 수 있습니다.

### 핀 (Pin) 기능

- 사용자는 자신의 포스트를 프로필 상단에 고정할 수 있습니다.
- 프로필의 `PinnedFeedsGrid`에 Masonry 레이아웃으로 표시됩니다.
- `YumTab`에서 롱프레스하여 핀 토글 가능합니다.

### 좋아요 / 댓글

- **좋아요**: 트랜잭션 기반으로 원자적 토글 (자기 포스트 좋아요 불가)
- **댓글**: 실시간 스트림으로 표시, 작성/수정/삭제 지원
- **카운트**: `likes_count`, `comments_count` 필드로 포스트 문서에 캐시

### 음성 입력 + GPT 연동

`RecipeEditPage`에서 사용:
1. `speech_to_text` 패키지로 한국어/영어 음성 인식
2. 인식된 텍스트를 GPT-4o-mini API로 전송
3. 원본 레시피 대비 수정 사항을 자동 반영
4. 재료 추가/삭제, 조리법 수정 등 처리

### 게스트북 (스티키 노트)

- 다른 사용자의 프로필에 짧은 메시지(최대 20자)를 남길 수 있습니다.
- 5가지 파스텔 색상 중 선택 가능
- 핸드라이팅 스타일 폰트 (NanumPenScript)
- 노트 핀 고정, 편집, 삭제 기능
- Masonry 그리드 레이아웃으로 표시

### 바이오메트릭 자동 로그인

1. 이전에 로그인한 기록이 있는지 확인 (`has_logged_in_before`)
2. 저장된 ID 토큰이 있는지 확인
3. 기기 바이오메트릭 지원 여부 확인
4. Face ID / 지문 인증 성공 시 자동 로그인

### 피드 필터

| 필터 | 정렬 기준 | 조건 |
|------|----------|------|
| Realtime | `created_at` DESC | PUBLIC, archived=false |
| Hot | `likes_count` DESC | PUBLIC, likes > 0, value != Wack |
| Wack | `likes_count` DESC | PUBLIC, value == Wack |
| Personal | `created_at` DESC | 팔로잉 사용자의 PUBLIC 포스트 (차단 제외) |

---

## 관련 문서

- [아키텍처](./ARCHITECTURE.md)
- [백엔드 통합](./BACKEND.md)
- [데이터 모델](./DATA_MODELS.md)
- [개발 환경 설정](./SETUP.md)
