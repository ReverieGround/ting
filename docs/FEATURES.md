# FEATURES.md — T!ng Feature Specification

> T!ng 앱의 전체 기능 명세. 사용자 시스템, 피드, 게시물, 레시피, 소셜 기능 등 모든 기능을 다룬다.

---

## 1. App Concept

**T!ng**은 음식 경험을 공유하고 레시피를 탐색하며, 음식을 사랑하는 사람들끼리 연결되는 **한국형 소셜 푸드 커뮤니티** 앱이다.

| 항목 | 설명 |
|---|---|
| **슬로건** | "소셜 푸드 커뮤니티" |
| **핵심 가치** | 일상의 음식 경험을 기록하고 공유하는 **푸드 다이어리** + 레시피 탐색 및 AI 보조 편집을 통한 **요리 도우미** |
| **타겟 사용자** | 요리와 음식 경험 공유에 관심 있는 한국어 사용자 |

> **한 줄 요약**: "오늘 뭐 먹었는지 기록하고, 새로운 레시피를 발견하고, 음식 친구를 만나는 앱"

---

## 2. User System

### 2.1 인증 (Authentication)

사용자가 앱에 로그인하는 방식이다. 현재는 Google 계정 로그인만 지원한다.

**로그인 과정**:
```
Google 로그인 버튼 탭 → Google 계정 선택 → 인증 완료 → 앱 진입
```

| 로그인 방식 | 상태 | 비고 |
|---|---|---|
| Google 로그인 | **구현 완료** | `@react-native-google-signin/google-signin` |
| Facebook 로그인 | UI 스텁 | 향후 구현 예정 |
| Kakao 로그인 | UI 스텁 | 향후 구현 예정 |
| Naver 로그인 | UI 스텁 | 향후 구현 예정 |

**기술 세부사항**:
- Firebase Auth `signInWithCredential`로 인증 처리
- `webClientId` (웹 타입) + `iosClientId` (iOS 타입) 동시 설정
- 최초 로그인 시 Firestore `users/{uid}` 문서 존재 여부로 온보딩 필요 판별
- 로그인 이력 추적: `has_logged_in_before` (Expo SecureStore)

### 2.2 온보딩 (Onboarding)

최초 가입 시 보여주는 **프로필 설정** 페이지다. 앱을 사용하기 전에 기본 정보를 입력받는다.

```
Google 로그인 성공 → 프로필 설정 페이지 → 정보 입력 → 앱 메인으로 이동
```

| 입력 항목 | 필수 여부 | 설명 | 예시 |
|---|---|---|---|
| 닉네임 | **필수** | 앱에서 표시되는 이름 | "맛집탐험가" |
| 국가 | **필수** | 국가 선택 (Picker UI) | KR / US / JP |
| 자기소개 | 선택 | 한 줄 소개 | "음식을 사랑합니다" |
| 프로필 이미지 | 선택 | 카메라 촬영 또는 앨범에서 선택 | (사진) |

- **건너뛰기 가능**: 닉네임과 국가만 입력하면 나머지는 나중에 설정 가능
- `authService.registerUser()`로 Firestore에 사용자 문서 생성
- 완료 시 앱 상태 → `authenticated` (메인 피드로 이동)

### 2.3 프로필 (Profile)

#### 내 프로필 (`/(tabs)/profile`)

```
┌─────────────────────────────────┐
│  ┌──────┐                       │
│  │  📷  │  맛집탐험가            │  ← 프로필 이미지 + 닉네임
│  └──────┘  푸드 크리에이터       │  ← 타이틀
│           "오늘도 맛있는 하루!"   │  ← 상태 메시지
├─────────────────────────────────┤
│   Yum    Recipes  Followers Following │  ← 통계 카운터
│    12      5        48       123      │
├─────────────────────────────────┤
│  [Yum]  [Pin]  [Guestbook]      │  ← 탭 전환
├─────────────────────────────────┤
│  ┌───┐ ┌───┐ ┌───┐              │
│  │ 🖼 │ │ 🖼 │ │ 🖼 │            │  ← 3열 게시물 그리드
│  └───┘ └───┘ └───┘              │
│  ┌───┐ ┌───┐ ┌───┐              │
│  │ 🖼 │ │ 🖼 │ │ 🖼 │            │
│  └───┘ └───┘ └───┘              │
└─────────────────────────────────┘
```

- **Yum 탭**: 내가 쓴 게시물을 3열 이미지 그리드로 표시
- **Pin 탭**: 핀 고정한 게시물 목록
- **Guestbook 탭**: 방명록 (포스트잇 스타일 메모)
- Followers/Following 숫자를 탭하면 사용자 목록 페이지로 이동

#### 다른 사용자 프로필 (`/(tabs)/profile/[userId]`)

- 내 프로필과 동일한 레이아웃
- **팔로우 버튼** 추가 표시
- 게시물 공개 범위에 따라 볼 수 있는 게시물이 다름 (Visibility 기반)

---

## 3. Feed System

피드는 앱의 메인 화면으로, 다양한 음식 게시물을 탐색할 수 있다.

### 3.1 피드 유형

상단 필터 탭으로 4가지 피드를 전환할 수 있다.

| 탭 | 키 | 설명 | 정렬 기준 | 사용 예시 |
|---|---|---|---|---|
| **전체** | `realtime` | 모든 공개 게시물 | 최신순 | "방금 올라온 게시물 보기" |
| **Hot** | `hot` | 인기 게시물 | 좋아요 많은순 | "요즘 인기 있는 음식 보기" |
| **Wack** | `wack` | 실패한 음식 경험 | 좋아요 많은순 | "웃긴 음식 실패담 보기" |
| **Personal** | `personal` | 팔로잉 유저의 게시물 | 최신순 | "내 친구들의 음식 근황 보기" |

- `@shopify/flash-list`로 대량 게시물도 부드럽게 스크롤
- Pull-to-refresh (아래로 당겨서 새로고침) 지원
- 밑줄 인디케이터로 현재 활성 탭 표시

### 3.2 피드 카드 (FeedCard)

하나의 게시물을 표현하는 카드 컴포넌트다.

```
┌─────────────────────────────────┐
│  [아바타] 맛집탐험가    ···  12h │  ← Head: 프로필, 닉네임, 시간, 메뉴
├─────────────────────────────────┤
│                                  │
│       [ 이미지 캐러셀 ]          │  ← FeedImages: 좌우 스와이프
│    [요리] [Fire]                 │  ← 카테고리 + 리뷰 태그 오버레이
│           · · ·                  │  ← 페이지 인디케이터
├─────────────────────────────────┤
│  ♡ 123    💬 45                  │  ← StatIcons: 좋아요 수, 댓글 수
├─────────────────────────────────┤
│  오늘 만든 파스타 너무 맛있었다! │  ← Content: 본문 텍스트
└─────────────────────────────────┘
```

**구성 컴포넌트**:

| 영역 | 컴포넌트 | 역할 |
|---|---|---|
| 상단 | `Head` | 프로필 이미지, 닉네임, 상대 시간, 더보기 메뉴 |
| 중앙 | `FeedImages` | 이미지 캐러셀 + 페이지 인디케이터 + 카테고리/리뷰 태그 |
| 하단 | `StatIcons` | 좋아요/댓글 아이콘 + 카운트 (좋아요 토글 가능) |
| 최하단 | `Content` | 게시물 본문 텍스트 |

### 3.3 게시물 상세 (PostPage)

피드 카드를 탭하면 이동하는 상세 페이지다.

- 피드 카드 전체 표시 (확대 버전)
- **실시간 댓글 섹션**: 새 댓글이 달리면 자동으로 화면에 표시
- **댓글 입력 바**: 화면 하단에 고정, 키보드가 올라와도 가려지지 않음 (`KeyboardAvoidingView`)
- 자기가 쓴 댓글은 삭제 가능

---

## 4. Post Creation

### 4.1 작성 플로우

게시물 작성은 2단계로 진행된다.

```
[작성 페이지]                    [확인 페이지]               [완료]
 이미지 선택                      미리보기 확인               피드에 표시
 카테고리/리뷰 선택    →  다음  →  공개 범위 선택    →  업로드  →  완료!
 본문 입력                        이미지 스택 프리뷰
```

### 4.2 작성 페이지 (`create/index`)

| 입력 항목 | 설명 | UI 컴포넌트 |
|---|---|---|
| 이미지 | `expo-image-picker`로 다중 선택 (최대 10장) | 이미지 그리드 + 추가 버튼 |
| 날짜 | 기본값 오늘, 과거 날짜 선택 가능 | `DatePickerButton` |
| 카테고리 | 요리 / 밀키트 / 식당 / 배달 중 택 1 | `CategoryChips` |
| 리뷰 | Fire / Tasty / Soso / Woops / Wack 중 택 1 | `ReviewChips` |
| 본문 | 멀티라인 텍스트 ("오늘의 한 줄을 남겨주세요...") | `PostTextField` |

**카테고리별 추가 입력 필드**:

선택한 카테고리에 따라 추가 입력 필드가 동적으로 나타난다.

| 카테고리 | 추가 입력 | 용도 |
|---|---|---|
| 요리 | 레시피 추천 토글 | 내 레시피를 추천하고 싶을 때 |
| 밀키트 | 밀키트 링크 입력 | 밀키트 구매 링크 공유 |
| 식당 | 식당 이름 입력 | 어디서 먹었는지 기록 |
| 배달 | 배달 링크 입력 | 배달 앱 링크 공유 |

### 4.3 확인 페이지 (`create/confirm`)

작성한 내용을 최종 확인하고 업로드하는 페이지다.

```
┌─────────────────────────────────┐
│                                  │
│    ┌─────┐                       │
│    │  🖼  │ ← 이미지 스택 프리뷰   │  ← 회전 효과로 겹쳐 보이는 이미지
│    └─────┘   (2장)               │
│                                  │
│  카테고리: 요리                   │  ← 선택 내용 미리보기
│  리뷰: Fire 🔥                   │
│  "오늘 만든 파스타 맛있었다!"     │
│                                  │
│  공개 범위: [PUBLIC ▼]           │  ← 공개 범위 선택
│                                  │
│  [ 업로드하기 ]                   │  ← 업로드 버튼
└─────────────────────────────────┘
```

- **공개 범위 선택**: PUBLIC / FOLLOWER / PRIVATE (상세는 Section 5 참조)
- 업로드 버튼 → 이미지 Cloud Storage 업로드 → Firestore 게시물 문서 생성

---

## 5. Post Visibility

게시물의 공개 범위를 3단계로 설정할 수 있다.

| 레벨 | 아이콘 | 설명 | 볼 수 있는 사람 |
|---|---|---|---|
| **PUBLIC** | 🌐 | 모든 사용자에게 공개 | 전체 |
| **FOLLOWER** | 👥 | 팔로워에게만 공개 | 작성자 본인 + 팔로워 |
| **PRIVATE** | 🔒 | 비공개 (나만 보기) | 작성자 본인만 |

> **예시**: A가 FOLLOWER로 게시물을 작성하면, A를 팔로우하는 B는 볼 수 있지만, A를 팔로우하지 않는 C는 볼 수 없다. A 본인은 항상 볼 수 있다.

`postService.fetchUserPosts()`에서 viewer(보는 사람)의 관계를 확인하여 Firestore 쿼리로 자동 필터링한다.

---

## 6. Like System

게시물에 좋아요를 누르는 기능이다.

**특징**:
- **Optimistic UI**: 좋아요 버튼을 누르면 서버 응답을 기다리지 않고 **즉시 UI에 반영**. 서버 처리가 실패하면 자동 롤백
- **자기 게시물 좋아요 방지**: 본인 게시물에는 좋아요를 누를 수 없음
- **더블 탭 방지**: `busyRef`로 빠른 연타를 막아 중복 요청 차단
- **Transaction 처리**: Firestore Transaction으로 `likes_count` 증감과 `likes` 문서 추가/삭제를 원자적으로 처리
- **실시간 동기화**: `useFirestoreDoc` 리스너로 좋아요 상태가 자동 동기화

> **Optimistic UI란?** 서버에 요청을 보내기 전에 미리 UI를 업데이트하는 패턴이다. 사용자는 즉각적인 반응을 느끼고, 만약 서버 요청이 실패하면 UI를 원래 상태로 되돌린다.

---

## 7. Follow System

### 7.1 팔로우/언팔로우

다른 사용자를 팔로우하면 그 사용자의 게시물을 Personal 피드에서 볼 수 있다.

- **Optimistic UI**: 팔로우/언팔로우 클릭 시 즉시 UI 반영, 실패 시 롤백
- **자기 자신 팔로우 방지**
- **양방향 관계 저장**:
  - 내 `following` 목록에 상대 추가
  - 상대의 `followers` 목록에 나를 추가

### 7.2 차단

특정 사용자를 차단하면 서로의 게시물이 보이지 않게 된다.

- 차단 시 **양방향 팔로우 관계가 모두 제거**됨 (서로 언팔로우)
- `follows/{uid}/blocked/{targetUid}` 문서가 생성됨
- 차단 해제 시 blocked 문서만 삭제 (팔로우는 자동 복구되지 않음)

### 7.3 사용자 목록

`/(tabs)/users/[userId]/list` 페이지에서 3개 탭을 제공한다.

| 탭 | 설명 | 표시 정보 |
|---|---|---|
| 팔로워 | 나를 팔로우하는 사용자 | 아바타 + 닉네임 + 타이틀 |
| 팔로잉 | 내가 팔로우하는 사용자 | 아바타 + 닉네임 + 타이틀 |
| 차단 | 내가 차단한 사용자 | 아바타 + 닉네임 + 타이틀 |

- 3열 그리드 레이아웃 (`ProfileAvatar` + 닉네임 + 타이틀)
- 각 사용자를 탭하면 해당 사용자의 프로필 페이지로 이동

---

## 8. Recipe System

### 8.1 레시피 목록

앱의 "요리하기" 탭에서 다양한 레시피를 탐색할 수 있다.

| 기능 | 설명 |
|---|---|
| 최신 레시피 조회 | Firestore에서 최신순으로 레시피 목록 로드 |
| 카테고리 필터 | 음식 종류(한식, 양식 등) / 조리 방법(볶음, 찜 등)으로 필터링 |
| 태그 검색 | 태그 키워드로 레시피 검색 |
| 카드 레이아웃 | 수평 스크롤 카드 (이미지 + 제목 + 팁) |

### 8.2 레시피 상세

레시피 카드를 탭하면 보이는 상세 페이지다.

```
┌─────────────────────────────────┐
│                                  │
│     [ 레시피 메인 이미지 ]        │
│                                  │
├─────────────────────────────────┤
│  김치찌개                        │  ← 레시피 제목
├─────────────────────────────────┤
│  💡 팁                           │
│  "김치는 잘 익은 것을 사용하면    │  ← 요리 팁
│   더 깊은 맛이 납니다"            │
├─────────────────────────────────┤
│  📊 영양 정보                    │
│  칼로리  탄수화물  단백질  지방   │  ← 영양 정보
│   320     28g     18g    12g    │
├─────────────────────────────────┤
│  🥕 재료                         │
│  · 김치 300g                     │  ← 재료 목록
│  · 돼지고기 200g                 │
│  · 두부 1모                      │
├─────────────────────────────────┤
│  📝 조리 순서                    │
│  1. 김치를 적당한 크기로 자른다   │  ← 단계별 조리법
│  2. 돼지고기를 볶는다            │
│  3. ...                          │
├─────────────────────────────────┤
│  [ 요리하고 공유하기 ]            │  ← 편집 모드 진입 버튼
└─────────────────────────────────┘
```

### 8.3 레시피 편집 (요리 기록)

앱에서 가장 복잡한 페이지다 (`recipes/edit.tsx`, 1100+ 라인). 레시피를 보면서 실제로 요리한 내용을 기록할 수 있다.

**주요 기능**:

| 기능 | 설명 | 상세 |
|---|---|---|
| 재료 편집 | 재료 추가/삭제/수정 | 변경된 재료에 `isModified` 표시 |
| 조리법 편집 | 단계 추가/삭제/수정 | 기존 스텝 사이에 새 스텝 삽입 가능 |
| 음성 입력 | `expo-speech-recognition` (한국어) | 말로 레시피 수정 지시, 텍스트 입력 폴백 |
| AI 편집 | GPT-4o-mini로 레시피 수정 요청 | 자연어로 "간을 좀 더 세게" 같은 요청 가능 |
| 이미지 | 캐러셀 형태로 보기/추가/삭제 | 카메라 촬영 또는 앨범에서 선택 |
| 원본/편집 토글 | 원본 레시피와 편집 버전 전환 | 원본을 언제든 확인 가능 |

**AI 레시피 편집 플로우**:

```
사용자: "간을 좀 더 세게 해줘" (음성 또는 텍스트)
    │
    ▼
gptService.sendRecipeEditRequest(현재 레시피, 사용자 메시지)
    │
    ▼
GPT-4o-mini (JSON 모드로 응답)
    │
    ▼
수정된 레시피가 UI에 자동 반영 (변경된 부분 하이라이트)
```

---

## 9. Guestbook (방명록)

### 9.1 스티키 노트

프로필 페이지의 Guestbook 탭에서 **포스트잇 스타일의 짧은 메모**를 작성할 수 있다.

| 항목 | 설명 | 예시 |
|---|---|---|
| 텍스트 | 메모 내용 | "프로필 멋져요!" |
| 색상 | ARGB 색상 코드 (다양한 색상 선택 가능) | 노란색, 분홍색, 하늘색 등 |
| 고정 | 상단 고정 여부 | 프로필 소유자가 고정 설정 |
| 작성자 | 아바타 + 닉네임 + 작성 시간 표시 | "맛집탐험가 · 5분 전" |

### 9.2 표시 방식

```
┌───────┐ ┌───────┐ ┌───────┐
│ 📌    │ │       │ │       │
│ 멋진  │ │ 요리  │ │ 다음에│    ← 2~3열 그리드
│ 프로필│ │ 잘하네│ │ 같이  │       포스트잇 스타일
│       │ │       │ │ 먹자! │
│ by 맛 │ │ by 푸 │ │ by 요 │
│ 5분전 │ │ 1시간 │ │ 어제  │
└───────┘ └───────┘ └───────┘
```

- **2~3열 그리드**: 화면 너비에 따라 자동 조절
- **messy 모드**: 메모 ID 기반으로 각 노트에 랜덤 회전 효과 적용 (실제 포스트잇처럼 보임)
- **실시간 동기화**: `useFirestoreQuery` 리스너로 새 메모가 즉시 표시
- **정렬**: 📌 고정 메모 우선, 그 다음 최신순

---

## 10. Post Management

### 10.1 핀 (Pin)

중요한 게시물을 프로필 상단에 고정하는 기능이다.

- **YumTab에서 게시물 롱프레스** → 핀/언핀 토글 메뉴 표시
- 핀된 게시물은 프로필의 **Pin 탭**에서 설정한 순서대로 표시
- `postService.pinPost()` / `unpinPost()` / `togglePin()`으로 관리

### 10.2 수정

게시물의 일부 속성을 수정할 수 있다.

| 수정 가능 항목 | 설명 |
|---|---|
| 공개 범위 | PUBLIC / FOLLOWER / PRIVATE 변경 |
| 카테고리 | 요리 / 밀키트 / 식당 / 배달 변경 |
| 리뷰 값 | Fire / Tasty / Soso / Woops / Wack 변경 |

- `postService.updateFields()`로 특정 필드만 업데이트

### 10.3 삭제

- **소프트 삭제** 방식: 실제로 데이터를 지우지 않고 `archived: true`로 표시
- 소프트 삭제된 게시물은 피드와 프로필에서 보이지 않음
- `postService.softDelete()`로 처리

> **소프트 삭제란?** 데이터를 실제로 삭제하지 않고 "삭제됨" 표시만 하는 방식이다. 실수로 삭제한 경우 복구가 가능하고, 데이터 분석에도 활용할 수 있다.

---

## 11. Image Handling

앱 전반에서 이미지를 다루는 방식이다.

| 기능 | 사용 기술 | 설명 |
|---|---|---|
| 이미지 선택 | `expo-image-picker` | 카메라 촬영 또는 앨범에서 선택 |
| 이미지 표시 | `expo-image` v3 | 고성능 렌더링, content-fit, 트랜지션 효과 |
| 이미지 업로드 | Firebase Storage (`storageService`) | Cloud Storage에 안전하게 저장 |
| 다중 업로드 | `Promise.all()` | 여러 이미지를 동시에 병렬 업로드 |
| 이미지 삭제 | `deleteByUrl()` | URL로 Storage 파일 참조를 찾아서 삭제 |

---

## 12. Theme & UI

### 12.1 색상 팔레트

다크 모드 전용 디자인이다. 어두운 배경에 밝은 텍스트를 사용하여 눈의 피로를 줄인다.

| 용도 | 색상 | 미리보기 |
|---|---|---|
| 배경 (기본) | `#0F1115` | ████ 짙은 회색-검정 |
| 배경 (더 어두운) | `#0B0D10` | ████ 거의 검정 |
| Primary / 텍스트 | `#EAECEF` | ████ 밝은 회색-흰색 |
| 탭 활성 | `#EAECEF` | ████ 밝은 회색-흰색 |
| 탭 비활성 | `rgba(255,255,255,0.78)` | ████ 약간 투명한 흰색 |
| 카테고리 칩 활성 | `#C7F464` | ████ 라임 그린 |
| 힌트 텍스트 | `rgba(234,236,239,0.6)` | ████ 60% 투명 텍스트 |
| 보더 | `rgba(234,236,239,0.15)` | ████ 15% 투명 보더 |

### 12.2 레이아웃

| 요소 | 사양 |
|---|---|
| 전체 방향 | Dark mode 전용 UI |
| Safe Area | `SafeAreaView` + `useSafeAreaInsets()` (노치/다이나믹 아일랜드 대응) |
| 간격(Spacing) | `xs: 4` / `sm: 8` / `md: 16` / `lg: 24` / `xl: 32` px |
| 보더 라디우스 | `sm: 8` / `md: 14` / `lg: 20` / `full: 9999` px |
| 키보드 대응 | `KeyboardAvoidingView` (입력 페이지에서 키보드에 맞춰 화면 조절) |
| 탭 바 | 반투명 (`rgba(15,17,21,0.85)`), absolute 포지션 |
| 리스트 하단 여백 | `paddingBottom: 100` (탭 바에 가려지지 않도록) |

---

## 13. Korean Language Support

앱은 한국어를 기본 언어로 사용한다.

| 기능 | 구현 방식 | 예시 |
|---|---|---|
| UI 텍스트 | 한국어 하드코딩 (별도 i18n 시스템 없음) | "커뮤니티", "요리하기" |
| 한국어 조사 처리 | `koreanGrammar.ts` — 종성 기반 조사 자동 선택 | "파스타**를**" vs "밥**을**" |
| 상대 시간 | `timeAgo()` — 한국어 형식 | "방금 전", "5분 전", "3시간 전", "어제" |
| 음성 인식 | `expo-speech-recognition` 한국어 설정 | 레시피 편집 시 음성 입력 |

> **한국어 조사 처리 예시**: 한국어에서는 앞 글자의 받침 유무에 따라 조사가 달라진다. "치킨**을**" (받침 있음) vs "파스타**를**" (받침 없음). `attachObjectParticle()` 함수가 이를 자동으로 처리한다.

---

## 14. Roadmap

### 14.1 미구현 기능

| 기능 | 현재 상태 | 우선순위 |
|---|---|---|
| Facebook 로그인 | UI 스텁 (버튼만 존재) | 중 |
| Kakao 로그인 | 미구현 | 중 |
| Naver 로그인 | 미구현 | 중 |
| 검색 기능 | UI 존재, 비즈니스 로직 미구현 | 높음 |
| 알림 시스템 | 미구현 | 높음 |
| 다국어 지원 (i18n) | 한국어 하드코딩 상태 | 낮음 |

### 14.2 개선 예정

| 항목 | 설명 |
|---|---|
| 테스트 코드 | 유닛 테스트 및 통합 테스트 작성 |
| 에러 바운더리 | 앱 크래시 방지를 위한 에러 핸들링 UI |
| 이미지 크롭 | 업로드 전 이미지 자르기 기능 |
| 프로필 편집 | 닉네임, 자기소개, 프로필 이미지 변경 |
| 댓글 알림 | 내 게시물에 댓글이 달리면 푸시 알림 |
