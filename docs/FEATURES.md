# FEATURES.md — T!ng 기능 명세서

## 1. 앱 컨셉

**T!ng** 은 음식 경험을 공유하고 레시피를 탐색하며, 음식을 사랑하는 사람들끼리 연결되는 한국형 소셜 푸드 커뮤니티 앱이다.

- **슬로건**: "소셜 푸드 커뮤니티"
- **핵심 가치**: 일상의 음식 경험을 기록하고 공유하는 **푸드 다이어리** + 레시피 탐색 및 AI 보조 편집을 통한 **요리 도우미**

---

## 2. 사용자 시스템

### 2.1 인증

- **Google OAuth**: `@react-native-google-signin/google-signin`을 통한 네이티브 구글 로그인
- Firebase Auth `signInWithCredential`로 인증 처리
- `webClientId` (웹 타입) + `iosClientId` (iOS 타입) 동시 설정
- 최초 로그인 시 Firestore `users/{uid}` 문서 존재 여부로 온보딩 필요 판별
- 로그인 이력 추적: `has_logged_in_before` (SecureStore)

**로그인 화면 구성**:
| 버튼 | 상태 |
|---|---|
| Google 로그인 | 구현 완료 |
| Facebook 로그인 | 스텁 (TODO) |
| Kakao 로그인 | 스텁 (TODO) |
| Naver 로그인 | 스텁 (TODO) |

### 2.2 온보딩

최초 가입 시 프로필 설정 페이지로 리다이렉트:

| 항목 | 필수 | 설명 |
|---|---|---|
| 닉네임 | O | 사용자 표시 이름 |
| 국가 | O | KR / US / JP 선택 (Picker) |
| 자기소개 | X | 한 줄 소개 |
| 프로필 이미지 | X | `expo-image-picker`로 촬영/선택 |

- **건너뛰기** 가능 (닉네임 + 국가만 필수)
- `authService.registerUser()`로 Firestore 문서 생성
- 완료 시 authStore status → `authenticated`

### 2.3 프로필

**내 프로필 (`/(tabs)/profile`)**:
- 프로필 이미지, 닉네임, 타이틀, 상태 메시지 표시
- 통계: Yum(게시물 수), Recipes, Followers, Following
- Followers/Following 클릭 시 사용자 목록 페이지로 이동
- 탭 구성: Yum (게시물 그리드) | Pin (고정 게시물) | Guestbook (방명록)

**다른 사용자 프로필 (`/(tabs)/profile/[userId]`)**:
- 동일 레이아웃 + 팔로우 버튼 표시
- 비공개 게시물 접근 제한 (Visibility 기반)

---

## 3. 피드 시스템

### 3.1 피드 유형

| 탭 | 키 | 설명 | 정렬 기준 |
|---|---|---|---|
| 전체 | `realtime` | 모든 공개 게시물 | `created_at` 최신순 |
| Hot | `hot` | 인기 게시물 | `likes_count` 높은순 |
| Wack | `wack` | value가 'Wack'인 게시물 | `likes_count` 높은순 |
| Personal | `personal` | 팔로잉 유저의 게시물 | `created_at` 최신순 |

- 상단 필터 탭으로 전환 (밑줄 인디케이터)
- `@shopify/flash-list`로 고성능 리스트 렌더링
- Pull-to-refresh 지원

### 3.2 피드 카드 (FeedCard)

하나의 게시물을 표현하는 카드 컴포넌트:

```
┌─────────────────────────────┐
│  [Avatar] userName   ··· 12h│  ← Head (프로필, 이름, 시간, 메뉴)
├─────────────────────────────┤
│                             │
│      [이미지 캐러셀]         │  ← FeedImages (페이지네이션 + 태그)
│   [카테고리] [리뷰]          │
│          · · ·              │
├─────────────────────────────┤
│  ♡ 123    💬 45             │  ← StatIcons (좋아요, 댓글)
├─────────────────────────────┤
│  오늘의 한 줄 내용...        │  ← Content
└─────────────────────────────┘
```

### 3.3 게시물 상세 (PostPage)

- 피드 카드 전체 표시 + 댓글 섹션
- 실시간 댓글 리스너 (`useFirestoreQuery`)
- 댓글 입력 바 (하단 고정, `KeyboardAvoidingView`)
- 자기 댓글 삭제 가능

---

## 4. 게시물 작성

### 4.1 작성 플로우

```
작성 페이지 (create/index) → 확인 페이지 (create/confirm) → 업로드 완료
```

### 4.2 작성 페이지

| 항목 | 설명 |
|---|---|
| 이미지 | `expo-image-picker` 다중 선택 (최대 10장) |
| 날짜 | `DatePickerButton` (기본값: 오늘) |
| 카테고리 | `CategoryChips` — 요리 / 밀키트 / 식당 / 배달 |
| 리뷰 | `ReviewChips` — Fire / Tasty / Soso / Woops / Wack |
| 본문 | `PostTextField` (멀티라인, "오늘의 한 줄을 남겨주세요...") |
| 조건부 입력 | 카테고리에 따라 추가 필드 표시 |

**카테고리별 추가 필드**:

| 카테고리 | 추가 입력 |
|---|---|
| 요리 | 레시피 추천 토글 |
| 밀키트 | 밀키트 링크 입력 |
| 식당 | 식당 이름 입력 |
| 배달 | 배달 링크 입력 |

### 4.3 확인 페이지

- 이미지 스택 프리뷰 (회전 효과)
- 카테고리, 리뷰, 이미지 수, 본문 미리보기
- **공개 범위 선택**: PUBLIC / FOLLOWER / PRIVATE
- 업로드 버튼 → 이미지 업로드 → 게시물 생성

---

## 5. 게시물 공개 범위

| 레벨 | 설명 | 접근 가능자 |
|---|---|---|
| **PUBLIC** | 모든 사용자에게 공개 | 전체 |
| **FOLLOWER** | 팔로워에게만 공개 | 작성자 + 팔로워 |
| **PRIVATE** | 비공개 | 작성자만 |

`postService.fetchUserPosts()`에서 viewer의 관계(owner/follower)를 확인하여 Firestore `whereIn` 쿼리로 필터링한다.

---

## 6. 좋아요 시스템

- **Optimistic UI**: 클릭 즉시 UI 반영, 실패 시 롤백
- 자기 게시물 좋아요 방지 (가드)
- 더블 탭 방지 (`busyRef`)
- Firestore Transaction으로 `likes_count` 증감 + `likes` 서브컬렉션 문서 추가/삭제
- 실시간 리스너 (`useFirestoreDoc`)로 좋아요 상태 동기화

---

## 7. 팔로우 시스템

### 7.1 팔로우/언팔로우

- **Optimistic UI**: 클릭 즉시 UI 반영, 실패 시 롤백
- 자기 자신 팔로우 방지
- 양방향 관계 저장:
  - `follows/{uid}/following/{targetUid}`
  - `follows/{targetUid}/followers/{uid}`

### 7.2 차단

- 차단 시 양방향 팔로우 관계 모두 제거
- `follows/{uid}/blocked/{targetUid}` 문서 생성
- 차단 해제 시 blocked 문서 삭제

### 7.3 사용자 목록

`/(tabs)/users/[userId]/list` 페이지에서 3개 탭 제공:

| 탭 | 설명 |
|---|---|
| 팔로워 | 나를 팔로우하는 사용자 |
| 팔로잉 | 내가 팔로우하는 사용자 |
| 차단 | 차단한 사용자 |

- 3열 그리드 (ProfileAvatar + 닉네임 + 타이틀)
- 클릭 시 해당 사용자 프로필로 이동

---

## 8. 레시피 시스템

### 8.1 레시피 목록

- Firestore에서 최신 레시피 조회
- 카테고리별 필터 (음식 종류 / 조리 방법)
- 태그 기반 검색
- 수평 카드 레이아웃 (이미지 + 제목 + 팁)

### 8.2 레시피 상세

```
┌─────────────────────────────┐
│     [레시피 이미지]           │
├─────────────────────────────┤
│  레시피 제목                 │
├─────────────────────────────┤
│  💡 팁                       │
├─────────────────────────────┤
│  📊 영양 정보                │
│  칼로리 / 탄수화물 / 단백질 / 지방│
├─────────────────────────────┤
│  🥕 재료 목록                │
├─────────────────────────────┤
│  📝 조리 순서                │
│  1. ...                     │
│  2. ...                     │
├─────────────────────────────┤
│  [요리하고 공유하기] 버튼     │
└─────────────────────────────┘
```

### 8.3 레시피 편집 (요리 기록)

앱에서 가장 복잡한 페이지 (`recipes/edit.tsx`, 1100+ 라인):

**기능 구성**:

| 기능 | 설명 |
|---|---|
| 재료 편집 | 추가/삭제/수정, 변경된 재료 `isModified` 플래그 표시 |
| 조리법 편집 | 추가/삭제/수정, 스텝 사이 삽입 가능 |
| 음성 입력 | `expo-speech-recognition` (한국어), 텍스트 폴백 |
| AI 편집 | GPT-4o-mini로 레시피 수정 요청 (gptService) |
| 이미지 | 캐러셀, 촬영/선택으로 추가, 삭제 가능 |
| 원본/편집 토글 | 원본 레시피와 편집 버전 전환 |

**AI 레시피 편집 플로우**:
```
사용자 음성/텍스트 입력 → gptService.sendRecipeEditRequest()
→ GPT-4o-mini (JSON 모드) → 수정된 레시피 반환 → UI 반영
```

---

## 9. 방명록 (게스트북)

### 9.1 스티키 노트

프로필 페이지의 Guestbook 탭에서 포스트잇 스타일의 메모를 작성:

| 항목 | 설명 |
|---|---|
| 텍스트 | 메모 내용 |
| 색상 | ARGB 색상 코드 (다양한 색상 선택) |
| 고정 | 상단 고정 여부 |
| 작성자 | 아바타 + 닉네임 + 작성 시간 |

### 9.2 표시

- 2~3열 그리드 (화면 너비에 따라)
- `messy` 모드: 메모 ID 기반 랜덤 회전 효과
- 실시간 리스너 (`useFirestoreQuery`)
- 고정 메모 우선, 그 다음 최신순

---

## 10. 게시물 관리

### 10.1 핀 (Pin)

- YumTab에서 게시물 롱프레스로 핀/언핀 토글
- 핀된 게시물은 프로필 Pin 탭에서 순서대로 표시
- `postService.pinPost()` / `unpinPost()` / `togglePin()`

### 10.2 수정

- 공개 범위 변경 (PUBLIC / FOLLOWER / PRIVATE)
- 카테고리 변경
- 리뷰 값 변경
- `postService.updateFields()`

### 10.3 삭제

- 소프트 삭제 (archived 플래그)
- `postService.softDelete()`

---

## 11. 이미지 처리

| 기능 | 사용 기술 |
|---|---|
| 이미지 선택 | `expo-image-picker` (카메라 + 라이브러리) |
| 이미지 표시 | `expo-image` (고성능, content-fit, 트랜지션) |
| 이미지 업로드 | Firebase Storage (`storageService`) |
| 다중 업로드 | `Promise.all()`로 병렬 처리 |
| 이미지 삭제 | URL 기반 Storage 파일 삭제 |

---

## 12. 테마 및 UI

### 12.1 색상 팔레트

| 용도 | 색상 |
|---|---|
| 배경 (라이트) | `#0F1115` (다크 모드) |
| 배경 (다크) | `#0B0D10` |
| Primary / 텍스트 | `#EAECEF` |
| 탭 활성 | `#EAECEF` |
| 탭 비활성 | `rgba(255,255,255,0.78)` |
| 카테고리 칩 활성 | `#C7F464` |
| 힌트 | `rgba(234,236,239,0.6)` |
| 보더 | `rgba(234,236,239,0.15)` |

### 12.2 레이아웃

- Dark mode 전용 UI
- `SafeAreaView` + `useSafeAreaInsets()` 대응
- 패딩: 4 / 8 / 16 / 24 / 32px (`spacing` 상수)
- 보더 라디우스: 8 / 14 / 20 / 9999px (`radius` 상수)
- `KeyboardAvoidingView`로 키보드 대응 (입력 페이지)
- 반투명 탭 바 (`rgba(15,17,21,0.85)`)

---

## 13. 한국어 지원

- UI 텍스트 대부분 한국어 하드코딩 (별도 i18n 시스템 없음)
- `koreanGrammar.ts`: 종성 기반 조사 처리 (`을/를` — `attachObjectParticle()`)
- `timeAgo()`: 한국어 상대 시간 ("방금 전", "5분 전", "3시간 전", "어제", "2월 20일")
- 음성 인식: `expo-speech-recognition` 한국어 설정

---

## 14. 향후 계획

### 14.1 미구현 기능

| 기능 | 상태 |
|---|---|
| Facebook 로그인 | 스텁 구현 (TODO) |
| Kakao 로그인 | 미구현 |
| Naver 로그인 | 미구현 |
| 검색 기능 | UI 존재, 로직 미구현 |
| 알림 시스템 | 미구현 |
| 다국어 지원 (i18n) | 미구현 (한국어 하드코딩) |

### 14.2 개선 예정

- 테스트 코드 작성
- 에러 바운더리 추가
- 이미지 크롭 기능
- 프로필 편집 (닉네임, 자기소개, 이미지 변경)
- 댓글 알림
